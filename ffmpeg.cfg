// Tutorial Article https://purp1e.top/hlaeffmpeg-en/
// Totorial Video [With English CC Subtitle] https://b23.tv/av56424646
// Auto-Download&Install&Update Tool [HLAE Updater] https://github.com/Purple-CSGO/HLAE-Updater
// 1.Install FFmpeg to ".\hlae\ffmpeg"
//   If you are using CSGO Demos Manager：%USERNAME%\AppData\Local\AkiVer\hlae\ffmpeg"
// 2.Use preset commands to change record settings i.e. p0 p1 p2
// 3.Default preset is p2 [Trade-off between quality and filesize/bitrate]
// 4.Pls use VLC、Potplayer to playback. It's quite common if you have stutter when playback

engine_no_focus_sleep 0	//make sure there's no frame drop when csgo is not selected/focused

//Remove presets
alias allclear "tga;mirv_streams settings remove prores;mirv_streams settings remove p4;mirv_streams settings remove p3;mirv_streams settings remove p2;mirv_streams settings remove p1;mirv_streams settings remove p0;"

//Define presets
mirv_streams settings add ffmpeg prores "-c:v prores  -profile:v 3 -pix_fmt yuv422p10le {QUOTE}{AFX_STREAM_PATH}.mov{QUOTE}"
mirv_streams settings add ffmpeg p4     "-c:v libx264 -preset 3 -crf 0  -pix_fmt yuv422p10le -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";
mirv_streams settings add ffmpeg p3     "-c:v libx264 -preset 3 -crf 6  -pix_fmt yuv422p10le -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";
mirv_streams settings add ffmpeg p2     "-c:v libx264 -preset 3 -crf 12 -pix_fmt yuv422p10le -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";
mirv_streams settings add ffmpeg p1     "-c:v libx264 -preset 3 -crf 17 -pix_fmt yuv422p10le -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";
mirv_streams settings add ffmpeg p0     "-c:v libx264 -preset 3 -crf 21 -pix_fmt yuv422p10le -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";

//If your editing software does not support 10bit, use these instead. don't have to change prores preset
//mirv_streams settings add ffmpeg p4 "-c:v libx264 -preset 3 -crf 0  -pix_fmt yuv422p -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";
//mirv_streams settings add ffmpeg p3 "-c:v libx264 -preset 3 -crf 6  -pix_fmt yuv422p -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";
//mirv_streams settings add ffmpeg p2 "-c:v libx264 -preset 3 -crf 12 -pix_fmt yuv422p -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";
//mirv_streams settings add ffmpeg p1 "-c:v libx264 -preset 3 -crf 17 -pix_fmt yuv422p -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";
//mirv_streams settings add ffmpeg p0 "-c:v libx264 -preset 3 -crf 21 -pix_fmt yuv422p -g 300 -keyint_min 50 {QUOTE}{AFX_STREAM_PATH}.mp4{QUOTE}";

//Define fast preset commands
mirv_exec alias tga    "mirv_streams settings edit afxDefault settings afxClassic;echo;echo {QUOTE}Current Record Preset: afxClassic - lossless tga sequence{QUOTE};echo;";
mirv_exec alias prores "mirv_streams settings edit afxDefault settings prores;echo;echo {QUOTE}Current Record Preset: Prores 422HQ{QUOTE};echo;";
mirv_exec alias p4     "mirv_streams settings edit afxDefault settings p4;echo;echo {QUOTE}Current Record Preset: p4{QUOTE};echo;";
mirv_exec alias p3     "mirv_streams settings edit afxDefault settings p3;echo;echo {QUOTE}Current Record Preset: p3{QUOTE};echo;";
mirv_exec alias p2     "mirv_streams settings edit afxDefault settings p2;echo;echo {QUOTE}Current Record Preset: p2{QUOTE};echo;";
mirv_exec alias p1     "mirv_streams settings edit afxDefault settings p1;echo;echo {QUOTE}Current Record Preset: p1{QUOTE};echo;";
mirv_exec alias p0     "mirv_streams settings edit afxDefault settings p0;echo;echo {QUOTE}Current Record Preset: p0{QUOTE};echo;";

//Print to console
echo "──────────────────────────────────────"
echo "1.Pls install HLAE&FFmpeg correctly"
echo "3.Use this before exec again: allclear"
echo "2.Do set host_framerate > 0"
echo "4.Test environment：1920x1080 300FPS"
echo "──────────┬────────────┬──────────────"
echo "Commands  |   Bitrate≈ |  Record Speed"
echo "──────────┼────────────┼──────────────"
echo "tga       |  104GB/min |  55FPS(SSD)"
echo "prores    |   27GB/min |  54FPS"
echo "p4        |   10GB/min |  43FPS"
echo "p3        |  5.4GB/min |  46FPS"
echo "p2        |  2.3GB/min |  49FPS"
echo "p1        |    1GB/min |  49FPS"
echo "p0        |  400MB/min |  50FPS"
echo "──────────┴────────────┴──────────────"

//Set default preset. Change if you want to
p2;

